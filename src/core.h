
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

typedef struct {
	u32 dummy;
} DrawContext;


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// CORE STATE //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

typedef struct CoreState CoreState;
struct CoreState {
	Stack main_stack;
	R_Renderer *rend;
	R_Window   *r_window;
	F_Cache    *f_cache;

	// Todo, remove really ...
	RID default_texture;

	WID window;
	RID base;
	RID output_target;

	// normalized mouse coordinates within the
	// output rectangle
	vec2         mouse;

	// frame limiting stuff
	i64          begin_cycle_clock;
	f64          target_fps;

	// Todo, this is per window
	MsfGifState gif_state;
	b32         gif_capture;


	// todo: this is silly, replace with UV matrix or something
	vec2i     mirrortextureonce;

	// inverse resolution of the currently bound texture
	vec2      texture_inv_resolution;

	TTF_Font    *font;

	Matrix       xform;
	Matrix       xform_stack[16];
	int          xform_index;

	UV_Coords region;
	union {
		Color colors[4];
		struct {
			Color color_0;
			Color color_1;
			Color color_2;
			Color color_3;
		};
	};

	R_Pass      *passes;
	R_Vertex    *verts;
	u32          num_passes;
	u32          num_verts;
	u32          max_passes;
	u32          max_verts;
	R_PassParams params;
	u32          pass_offset;
	f32          texture_blend;

	DrawContext  ctx;
};
